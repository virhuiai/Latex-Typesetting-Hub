
% %\InputFile:boxes
% %%%% this is input file [boxes]
% %\tracingmacros=2 \tracingcommands\tracingmacros
% %\subject[boxes] Boxes
% \endofchapter
% \chapter{Boxes\\盒子}\label{boxes}

% The horizontal and vertical boxes of \TeX\ are containers for
% \term box\par
% pieces of horizontal and vertical lists.
% Boxes can be stored in box registers. 
% This chapter treats box registers and such
% aspects of boxes as their dimensions, and the way their components
% are placed relative to each other.

% \TeX\ 的水平盒子和垂直盒子是水平和垂直列表的容器。
% 盒子可以存储在盒子寄存器中。
% 本章介绍盒子寄存器以及盒子的尺寸和它们的组成部分相对于彼此的放置方式等方面。

% \begin{inventory}
% \item [\cs{hbox}] 
%       Construct a horizontal box.

%       构建一个水平盒子。
% \item [\cs{vbox}] 
%       Construct a vertical box with reference point of the last item.

%       构建一个垂直盒子，其参考点位于最后一个项目。
% \item [\cs{vtop}] 
%       Construct a vertical box with reference point of the first item.

%       构建一个垂直盒子，其参考点位于第一个项目。
% \item [\cs{vcenter}] 
%       Construct a vertical box vertically centred
%       on the math axis; this command can only be used in math mode.

%       构建一个在数学轴上垂直居中的垂直盒子；此命令只能在数学模式中使用。
% \item [\cs{vsplit}] 
%       Split off the top part of a vertical box. 

%       将垂直盒子的顶部部分分离出来。
% \item [\cs{box}] 
%       Use a box register, emptying it. 

%       使用一个盒子寄存器，并清空其内容。
% \item [\cs{setbox}] 
%       Assign a box to a box register.

%       将盒子赋值给一个盒子寄存器。
% \item [\cs{copy}] 
%       Use a box register, but retain the contents. 

%       使用一个盒子寄存器，但保留其内容。
% \item [\cs{ifhbox \cs{ifvbox}}]
% \mdqon
%       Test whether a box register contains a horizontal/""vertical box.

%       检查一个盒子寄存器是否包含一个水平/垂直盒子。
% \mdqoff

% \item [\cs{ifvoid}] 
%       Test whether a box register is empty.

%       检查一个盒子寄存器是否为空。
% \item [\cs{newbox}] 
%       Allocate a new box register. 

%       分配一个新的盒子寄存器。
% \item [\cs{unhbox \cs{unvbox}}]
%       Unpack a box register containing a horizontal/vertical box,
%       adding the contents to the current horizontal/vertical list,
%       and emptying the register. 

% 解开包含水平/垂直盒子的盒子寄存器，将其内容添加到当前的水平/垂直列表中，并清空寄存器。
% \item [\cs{unhcopy \cs{unvcopy}}]
%       The same as \cs{unhbox}$\,$/$\,$\cs{unvbox},
%       but do not empty the register. 

%       与 \cs{unhbox}$,$/$,$\cs{unvbox} 相同，但不清空寄存器。
% \item [\cs{ht \cs{dp} \cs{wd}}]
%       Height/depth/width of the box in a box register. 

%       盒子寄存器中盒子的高度/深度/宽度。
% \item [\cs{boxmaxdepth}] 
%       Maximum allowed depth of boxes.
%       Plain \TeX\ default:~\cs{maxdimen}.

%       盒子的最大允许深度。Plain \TeX\ 的默认值：\cs{maxdimen}。
% \item [\cs{splitmaxdepth}]
%       Maximum allowed depth of boxes generated by \cs{vsplit}.

%       \cs{vsplit} 生成的盒子的最大允许深度。
% \item [\cs{badness}] 
%       Badness of the most recently constructed box.

%       最近构建的盒子的劣度。
% \item [\cs{hfuzz \cs{vfuzz}}]
%       Excess size that \TeX\ tolerates before it considers  

%       在 \TeX\ 认为一个水平/垂直盒子过满之前，允许的多余尺寸。
% \mdqon
%       a horizontal/""vertical box overfull.
% \mdqoff

% \item [\cs{hbadness \cs{vbadness}}]
%       Amount of tolerance before \TeX\ reports an underfull 

%       在 \TeX\ 报告一个水平/垂直盒子不充分或过充分之前的容忍度。
% \mdqon
%       or overfull  horizontal/""vertical box.
% \mdqoff

% \item [\cs{overfullrule}] 
%       Width of the rule that is printed to indicate 
%       overfull horizontal boxes.

%       用于指示过度充满水平盒子的标尺的宽度。 
% \item [\cs{hsize}] 
%       Line width used for text typesetting inside a vertical box.
% \awp

% 用于垂直盒子内文本排版的行宽。
% \item [\cs{vsize}] 
%       Height of the page box.

%       页面盒子的高度。
% \item [\cs{lastbox}] 
%       Register containing the last item added to the current list, 
%       if this was a box.

%       寄存器，其中包含添加到当前列表中的最后一个项目，如果该项目是一个盒子。
% \item [\cs{raise \cs{lower}}]
%       Adjust vertical positioning of a box in horizontal mode. 

%       调整水平模式下盒子的垂直位置。
% \item [\cs{moveleft \cs{moveright}}]
%       Adjust horizontal positioning of a box in vertical mode. 

%       调整垂直模式下盒子的水平位置。
% \item [\cs{everyhbox \cs{everyvbox}}]
% \mdqon
%       Token list inserted at the start of a horizontal/""vertical box.

%       插入到水平/垂直盒子开始处的记号列表。
% \mdqoff

% \end{inventory}



% %\point Boxes
% \section{Boxes\\盒子}

% In this chapter we shall look at boxes. Boxes are containers
% for pieces of horizontal or vertical lists.
% Boxes that are needed more than once can be stored in box registers.

% 在本章中，我们将讨论盒子（boxes）。盒子是水平或垂直列表的容器。需要多次使用的盒子可以存储在盒子寄存器中。


% When \TeX\ expects a \gr{box}, any of the following forms
% is admissible:

% 当 \TeX\ 需要一个 \gr{box} 时，可以使用以下任意形式：

% \begin{itemize}
% \item \cs{hbox}\gr{box specification}\lb\gr{horizontal material}\rb
% \item \cs{vbox}\gr{box specification}\lb\gr{vertical material}\rb
% \item \cs{vtop}\gr{box specification}\lb\gr{vertical material}\rb
% \item \cs{box}\gr{8-bit number}
% \item \cs{copy}\gr{8-bit number}
% \item \cs{vsplit}\gr{8-bit number}\n{to}\gr{dimen}
% \item \cs{lastbox}
% \end{itemize}
% A \gr{box specification} is defined as\label{box:spec}

% \gr{box specification} 的定义为:
% \begin{disp}\gr{box specification} $\longrightarrow$ \gr{filler}
% \nl\indent$|$ \n{to} \gr{dimen}\gr{filler} 
%           $|$ \n{spread} \gr{dimen}\gr{filler}
% \end{disp}
% An \gr{8-bit number} is a number in the range~0--255.

% \gr{8-bit number} 是范围在 0--255 的数字。

% The braces surrounding box material define a group;
% they can be explicit characters
% of categories 1 and~2 respectively,
% or control sequences \cs{let} to such characters;
% see also below.

% 括号将盒子内容定义为一组；它们可以是类别码为 1 和 2 的显式字符，也可以是被 \cs{let} 给予这些字符的控制序列；详见下文。


% A \gr{box} can in general be used in horizontal, vertical,
% and math mode, but see below for the \cs{lastbox}.
% The connection between
% boxes and modes is explored further in Chapter~\ref{hvmode}.

% \gr{box} 通常可以在水平、垂直和数学模式中使用，但请参见下文有关 \cs{lastbox} 的内容。
% 盒子与模式之间的关系将在第~\ref{hvmode}~章中进一步探讨。


% The box produced by \cs{vcenter} \ldash a command that is allowed only in
% math mode \rdash  is not a \gr{box}. For instance,
% it can not be assigned with \verb=\setbox=; see further
% Chapter~\ref{math}.

% 由 \cs{vcenter} 生成的盒子（该命令仅在数学模式下允许）不是 \gr{box}。例如，它不能使用 \verb=\setbox= 进行赋值；详见第~\ref{math}~章。


% The \cs{vsplit} operation is treated in Chapter~\ref{page:break}.

% \cs{vsplit} 操作将在第~\ref{page:break}~章中介绍。


% %\point Box registers
% \section{Box registers\\盒子寄存器}

% There are 256 box registers, numbered 0--255. 
% \term box! registers\par
% Either a box register is  empty (`void'), or it contains a horizontal
% or vertical box.
% This section discusses specifically box {\em registers};
% the sizes of boxes, and the way material is arranged inside them,
% is treated below.
% \awp

% 有 256 个盒子寄存器，编号为 0--255。
% 一个盒子寄存器可以是空的（“void”），也可以包含一个水平盒子或垂直盒子。
% 本节具体讨论盒子 {\em 寄存器}；盒子的尺寸和其中的内容排列方式将在下面讨论。


% %\spoint Allocation: \cs{newbox}
% \subsection{Allocation: \cs{newbox}\\分配：\cs{newbox}}

% The plain \TeX\ \csidx{newbox} macro allocates an unused
% box register:

% 在 plain \TeX 中，\csidx{newbox} 宏用于分配一个未使用的盒子寄存器：
% \begin{verbatim}
% \newbox\MyBox 
% \end{verbatim}
% after which one can say

% 然后可以这样使用：
% \begin{verbatim}
% \setbox\MyBox=...
% \end{verbatim}
% or 或者\begin{verbatim}
% \box\MyBox
% \end{verbatim}
% and so on.
% Subsequent calls to this macro give subsequent box numbers;
% this way macro collections can allocate their own boxes
% without fear of collision with other macros.

% 等等。
% 后续对此宏的调用会给出连续的盒子编号；这样，宏集合可以分配自己的盒子，而不用担心与其他宏发生冲突。

% The number of the box is assigned by \cs{chardef}
% (see Chapter~\ref{alloc}). 
% This implies that \cs{MyBox} is equivalent to,
% and can be used as, a~\gr{number}.
% The control sequence
% \altt
% \cs{newbox} is an \cs{outer} macro.
% Newly allocated box registers are initially empty.

% 盒子的编号由 \cs{chardef} 分配（见第~\ref{alloc} 章）。
% 这意味着 \cs{MyBox} 等同于并且可以用作一个 \gr{number}。
% \cs{newbox} 控制序列是一个 \cs{outer} 宏。
% 新分配的盒子寄存器最初是空的。


% \subsection{Usage: \cs{setbox}, \cs{box}, \cs{copy}\\用法：\cs{setbox}、\cs{box}、\cs{copy}}

% A~register is filled by assigning a \gr{box}
% \cstoidx setbox\par
% to it:

% 通过将一个 \gr{box} 赋值给寄存器来填充它：
% \begin{Disp}\verb>\setbox>\gr{number}\gr{equals}\gr{box}\end{Disp}
% For example, the \gr{box} can be explicit

% 例如，\gr{box} 可以是显式的
% \begin{Disp}\verb>\setbox37=\hbox{...}>\quad or\quad \verb>\setbox37=\vbox{...}>
% \end{Disp}
% or it can be a box register:

% 例如，\gr{box} 可以是显式的
% \begin{verbatim}
% \setbox37=\box38
% \end{verbatim}
% Usually, box numbers will have been assigned by a \cs{newbox}
% command.

% 通常，盒子编号将通过 \cs{newbox} 命令进行分配。


% The box in a box register is appended
% by the commands \cs{box} and~\cs{copy}
% to whatever list \TeX\ is building: the call

% 通过 \cs{box} 和 \cs{copy} 命令，盒子寄存器中的盒子被附加到 \TeX\ 正在构建的任何列表中：
% 调用
% \begin{verbatim}
% \box38
% \end{verbatim}
% appends box~38.
% To save memory space, box registers become empty by using them:
% \TeX\ assumes that after you have inserted a box by
% calling \csidx{box}$nn$ in some mode, you do not need the
% contents of that register any more and empties it.
% In case you {\em do\/} need the contents of
% a box register more than once, 
% you can \csidx{copy} it. Calling \cs{copy}$nn$ is
% equivalent to \cs{box}$nn$ in all respects except that
% the register is not cleared.

% 将附加盒子 38。
% 为了节省内存空间，通过使用盒子寄存器来使其为空：
% \TeX\ 假定在你通过在某种模式下调用 \csidx{box}$nn$ 插入盒子后，你不再需要该寄存器的内容，并将其清空。
% 如果您{\em 需要}多次使用盒子寄存器的内容，
% 可以使用 \csidx{copy} 来复制它。调用 \cs{copy}$nn$ 在所有方面等效于 \cs{box}$nn$，只是寄存器不会被清空。

% It is possible to unwrap the contents of a box register
% by `unboxing' it using the commands \cs{unhbox} and \cs{unvbox},
% and their copying versions \cs{unhcopy} and \cs{unvcopy}.
% Whereas a box can be used in any mode, the
% unboxing operations can only be used in the appropriate mode,
% since in effect they contribute a partial
% horizontal or vertical list (see also Chapter~\ref{hvmode}).
% See below for more information on unboxing registers.
% \awp

% 可以通过使用 \cs{unhbox} 和 \cs{unvbox} 命令及其拷贝版本 \cs{unhcopy} 和 \cs{unvcopy} 来“解包”盒子寄存器的内容。
% 虽然盒子可以在任何模式下使用，但解包操作只能在适当的模式下使用，因为实际上它们贡献了一个部分的水平或垂直列表（也请参见第~\ref{hvmode} 章）。
% 有关在解包寄存器上的更多信息，请参见下文。
% \awp

% %\spoint Testing: \cs{ifvoid}, \cs{ifhbox}, \cs{ifvbox}
% \subsection{Testing: \cs{ifvoid}, \cs{ifhbox}, \cs{ifvbox}\\测试：\cs{ifvoid}、\cs{ifhbox}、\cs{ifvbox}}

% Box
% registers can be tested for their contents:

% 可以测试盒子寄存器的内容：
% \begin{disp}\cs{ifvoid}\gr{number}\end{disp}
% is true if the box register is empty.
% Note that an empty, or `void',
% box register is not the same as a register containing an empty box.
% An empty box is still either a horizontal or a vertical box;
% a~void register can be used as both.

% 如果盒子寄存器为空，则为真。
% 请注意，空的或“空”的盒子寄存器不同于包含空盒子的寄存器。
% 空盒子仍然是水平或垂直盒子；
% 空的寄存器可以用作两者。

% The test 测试
% \begin{disp}\cs{ifhbox}\gr{number}\end{disp}
% is true if the box register contains a horizontal box;

% 如果盒子寄存器包含水平盒子，则为真；

% \begin{disp}\cs{ifvbox}\gr{number}\end{disp}
% is true if the box register contains a vertical box.
% Both tests are false for void registers.

% 如果盒子寄存器包含垂直盒子，则为真。
% 对于空寄存器，这两个测试都为假。


% %\spoint[lastbox] The \cs{lastbox}
% \subsection{The \cs{lastbox}}
% \label{lastbox}

% When \TeX\ has built a partial list, the last box in this
% list is accessible as the \csidx{lastbox}. This behaves
% like a box register, so you can remove the last box from  the
% list by assigning the \cs{lastbox} to some  box register. 
% If the last item on the current list is not a box,
% the \cs{lastbox} acts like a void box register.
% It is not possible to get hold of the last box
% in the case of the main vertical list.
% The \cs{lastbox} is then always void.

% 当 \TeX\ 构建了一个部分列表时，该列表中的最后一个盒子可以通过 \csidx{lastbox} 访问。它的行为类似于一个盒子寄存器，因此可以通过将 \cs{lastbox} 赋值给某个盒子寄存器来从列表中删除最后一个盒子。如果当前列表上的最后一个项目不是一个盒子，则 \cs{lastbox} 的行为类似于一个空的盒子寄存器。在主垂直列表的情况下，无法获取到最后一个盒子。此时，\cs{lastbox} 总是空的。

% As an example, the statement 

% 举个例子，语句
% \begin{verbatim}
% {\setbox0=\lastbox}
% \end{verbatim}
% removes
% the last box from the current list, assigning it to box
% register~0. Since this assignment occurs inside a group,
% the register is cleared at the end of the group.
% At the start of a paragraph this can be used to remove the
% indentation box (see Chapter~\ref{par:start}).
% Another example of \cs{lastbox} can be found on page~\pageref{varioset}.

% 从当前列表中删除最后一个盒子，并将其赋值给盒子寄存器 0。由于此赋值发生在组内，因此该寄存器在组结束时会被清空。在段落的开头，可以使用它来删除缩进盒子（参见第~\ref{par:start}章）。另一个关于 \cs{lastbox} 的例子可以在第\pageref{varioset}~页找到。

% Because the \verb-\lastbox- is always empty in external vertical mode,
% it is not possible to get hold of boxes that have been 
% added to the page. However, it is possible to dissect
% the page once it is in \cs{box255}, for instance doing

% 由于在外部垂直模式中 \verb-\lastbox- 总是空的，所以无法获取已添加到页面上的盒子。但是，在输出例程中可以对页面进行分析，例如在输出例程内部执行以下操作：
% \begin{verbatim}
% \vbox{\unvbox255{\setbox0=\lastbox}}
% \end{verbatim}
% inside the output routine.

% If boxes in vertical mode have been shifted by \cs{moveright}
% or \cs{moveleft}, or if boxes in horizontal mode  have
% been raised by \cs{raise} or lowered by \cs{lower}, 
% any information about this
% displacement due to such a command is lost when
% the \cs{lastbox} is taken from the list.
% \awp

% 如果垂直模式中的盒子通过 \cs{moveright} 或 \cs{moveleft} 进行了偏移，或者水平模式中的盒子通过 \cs{raise} 进行了升高或 \cs{lower} 进行了降低，那么当从列表中获取 \cs{lastbox} 时，关于这些命令引起的偏移的任何信息都会丢失。


% %\point Natural dimensions of boxes
% \section{Natural dimensions of boxes\\盒子的自然尺寸}

% %\spoint Dimensions of created horizontal boxes
% \subsection{Dimensions of created horizontal boxes\\创建水平盒子的尺寸}

% Inside an \csidx{hbox} all constituents are lined up next to each other,
% \term box! dimensions\par
% with their reference points on the baseline of the box,
% unless they are moved explicitly in the vertical direction
% by \cs{lower} or~\cs{raise}.

% 在 \csidx{hbox} 内部，所有组成部分都相互排列在一起，它们的参考点位于盒子的基线上，除非通过 \cs{lower} 或 \cs{raise} 明确在垂直方向上移动。

% The resulting width of the box is the sum of the widths
% of the components. Thus the width of

% 盒子的宽度是组成部分的宽度之和。因此，
% \begin{verbatim}
% \hbox{\hskip1cm}
% \end{verbatim}
% is positive, and the width of

% 的宽度是正的，而 

% \begin{verbatim}
% \hbox{\hskip-1cm}
% \end{verbatim}
% is negative. By way of example,

% 的宽度是负的。例如，


% \begin{disp}\verb>a\hbox{\kern-1em b}-->\end{disp}
% gives as output

% 的输出结果是
% \begin{disp}\leavevmode\hphantom{b}a\hbox{\kern-1em b}--\end{disp}
% \message{check align input/output}
% which shows that a horizontal box can have negative
% width.

% 这表明水平盒子的宽度可以为负。

% The height and depth of an \cs{hbox} are the
% maximum amount that constituent boxes project above and
% below the baseline of the box. They are non-negative when the
% box is created.

% \cs{hbox} 的高度和深度是组成部分在基线之上和之下突出的最大量。当创建盒子时，它们是非负的。

% The commands \cs{lower} and \cs{raise} are the only possibilities
% for vertical movement inside an \cs{hbox} (other than
% including a \cs{vbox} inside the \cs{hbox}, of course);
% a~\gr{vertical command} \ldash such as \cs{vskip} \rdash 
% is not allowed in a horizontal box, and
% \cs{par}, although allowed,
% does not do anything inside a horizontal box.

% \cs{lower} 和 \cs{raise} 命令是在 \cs{hbox} 内部进行垂直移动的唯一可能性（当然，除了在 \cs{hbox} 中包含 \cs{vbox}）；\gr{vertical command}（如 \cs{vskip}）不允许在水平盒子中，而且虽然允许使用 \cs{par}，但在水平盒子中它不起作用。

