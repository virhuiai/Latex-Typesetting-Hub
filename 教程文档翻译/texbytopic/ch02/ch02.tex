% %\endinput

% %%%% end of input file [bigpic]

% %\InputFile:mouth
% %%%% this is input file [mouth]
% %\tracingmacros=2 \tracingcommands\tracingmacros
% %\subject[mouth] Category Codes \nl and Internal States
% \endofchapter
% \chapter{Category Codes and Internal States\\类别码和内部状态}\label{mouth}

% When characters are read, 
% \TeX\ assigns them
% category codes. The reading mechanism has three internal
% states, and transitions between these states are effected
% by category codes of characters in the input.
% This chapter describes how \TeX\ reads its input and
% how the category codes of characters influence the
% reading behaviour. Spaces and line ends are discussed.

% 当字符被读取时，\TeX 将为它们分配类别码。读取机制具有三个内部状态，并且这些状态之间的转换受输入中字符的类别码的影响。本章描述了 \TeX 如何读取其输入以及字符的类别码如何影响读取行为。还讨论了空格和换行符。

% \begin{inventory}
% \item [\cs{endlinechar}]  
%       The character code of the end-of-line character 
%       appended to input lines.
%       \IniTeX\ default:~13.

%       附加到输入行末尾的行结束符的字符码。
% \IniTeX 默认值：13。
% \item [\cs{par}]  
%       Command to close off a paragraph and go into vertical mode.
%       Is generated by empty lines.

%       用于结束段落并进入垂直模式的命令。
% 由空行生成。
% \item [\cs{ignorespaces}]   
%       Command that reads and expands until something is
%       encountered that is not a \gr{space token}.

%       读取并展开直到遇到非\gr{space token}的命令。
% \item [\cs{catcode}] 
%       Query or set category codes.

%       查询或设置类别码。
% \item [\cs{ifcat}]  
%       Test whether two characters have the same category code.

%       检查两个字符是否具有相同的类别码。
% \item [\cs{\char32}]
%       Control space.
%       Insert the same amount of space that a space token would
%       when \cs{spacefactor}${}=1000$.

%       控制空格。
% 插入与空格记号相同量的空格，当 \cs{spacefactor}${}=1000$ 时。%控制空格  不可见空格  % \verb*| |
% \item [\cs{obeylines}]
%       Macro in plain \TeX\ to make line ends significant.

%       plain \TeX 中使换行符具有意义的宏。
% \item [\cs{obeyspaces}]
%       Macro in plain \TeX\ to make (most) spaces significant.

%       plain \TeX 中使（大多数）空格具有意义的宏。
% \end{inventory}


% %\point Introduction
% \section{Introduction\\引言}

% \TeX's input processor scans input lines from a file or terminal, and
% makes tokens out of the characters.
% The input processor can be viewed as
% a simple finite state automaton with three internal states; 
% depending on the state its scanning behaviour may differ.
% This automaton will be treated here both from the point of view of the
% internal states and of the category codes governing the
% transitions.

% \TeX\ 的输入处理器从文件或终端扫描输入行，并将字符转换为记号。输入处理器可以看作是一个具有三个内部状态的简单有限状态自动机；根据状态的不同，其扫描行为可能有所不同。在这里，将从内部状态和控制状态转换的类别码的角度对该自动机进行讨论。


% %\point Initial processing
% \section{Initial processing\\初始处理}

% Input from a file (or from the user terminal, but this
% will not be mentioned specifically
% most of the time) is handled one line at a time.
% Here follows a discussion of what exactly is an input line
% for \TeX.

% 从文件（或用户终端，但大部分时间不会具体提到）获取的输入按行处理。下面讨论的是对于 \TeX\ 来说，什么是一个输入行。



% Computer systems differ with respect to 
% \term line! input\par\term line! end\par\term machine independence\par
% the exact definition of an input
% \mdqon
% line. The carriage return/""line feed
% \mdqoff
% \awp
% \message{slash-dash}%
% sequence terminating a line is most common,
% but some systems use just a line feed, and
% some systems with fixed record length (block) storage do not have
% a line terminator at all. Therefore \TeX\ has its
% own way of terminating an input line. 

% 关于%\term line! input\par\term line! end\par\term machine independence\par 
% 输入行的确切定义在不同的计算机系统中有所不同。以回车/换行\mdqon
% % \term line! input\mdqoff
% % \message{slash-dash}%
% 序列作为行终止符最为常见，但有些系统仅使用换行符，而一些固定记录长度（块）存储的系统根本没有行终止符。因此，\TeX\ 有自己的方式来终止一个输入行。

% % 计算机系统在对输入行的确切定义方面存在差异。回车/换行序列作为行终止符最为常见，但有些系统仅使用换行符，而一些使用固定记录长度（块）存储的系统根本没有行终止符。\TeX 有其自己的终止输入行的方式。


% \begin{enumerate}
% \item An input line is read from an input file  (minus the
% line terminator, if any).

% 从输入文件中读取一个输入行（如果有行终止符，则不包括终止符）。
% \item Trailing spaces are removed (this is for the systems
% with block storage, and it prevents confusion because these
% spaces are hard to see in an editor).

% 删除行尾的空格（这适用于使用块存储的系统，它可以避免在编辑器中难以看到这些空格时引起混淆）。
% \item The \cstoidx endlinechar\par, by default \gram{return}
% (code~13) is appended.
% If the value of \cs{endlinechar} is negative
% \label{append:elc}%
% or more than~255 (this was 127 in versions of \TeX\ older
% than version~3; see page~\pageref{2vs3} for more differences),
% no character is appended. 
% The effect then is the same as
% if the line were to end with a comment character.

% 默认情况下，追加一个\cstoidx endlinechar\par，即回车符（代码为 13）。如果 \cs{endlinechar} 的值为负数或大于 255（在早于版本 3 的 \TeX\ 中为 127；有关更多差异，请参见第 \pageref{2vs3} 页），则不追加任何字符。此时的效果与行以注释字符结束相同。
% \end{enumerate}


% Computers may also differ in the character encoding
% (the most common schemes are \ascii{} and \ebcdic{}), so \TeX\
% converts the characters that are read from the file to its
% own character codes. These codes are then used exclusively,
% so that \TeX\ will perform the same on any system.
% For more on this, see Chapter~\ref{char}.

% 计算机在字符编码方面也可能存在差异（最常见的方案是 \ascii{} 和 \ebcdic{}），因此 \TeX{} 将从文件中读取的字符转换为其自己的字符编码。然后，这些编码将被独占使用，以便 \TeX{} 在任何系统上执行相同的操作。有关更多信息，请参阅第~\ref{char} 章。



% %\point Category codes
% \section{Category codes\\类别码}

% Each of the 256 character codes (0--255) has an
% \term category codes\par
% associated category code, though not necessarily always the same one.
% There are 16 categories, numbered 0--15. 
% When scanning the input, \TeX\
% thus forms character-code--category-code pairs.
% The input processor sees only these pairs; from them are formed
% character tokens, control sequence tokens, and parameter tokens.
% These tokens are then passed to \TeX's expansion and execution
% processes.

% 每个字符编码（0--255）都有一个相关的类别码，尽管不一定总是相同的。共有16个类别，编号为0--15。在扫描输入时，\TeX{} 形成了字符编码--类别码对。输入处理器仅看到这些对；从中形成字符记号、控制序列记号和参数记号。然后将这些记号传递给 \TeX{} 的扩展和执行过程。

% A~character token is a character-code--category-code
% pair that is passed unchanged.
% A~control sequence token consists of one or more characters
% preceded by an escape character; see below.
% Parameter tokens are also explained below.

% 字符记号是传递的字符编码--类别码对，不做任何改变。控制序列记号由一个或多个字符组成，前面带有转义字符；请参阅下文。参数记号也将在下文中进行解释。

% This is the list of the categories, together with a brief
% description. More elaborate explanations follow in this and
% later chapters.

% 下面是类别码的列表，以及简要说明。在本章和后续章节中，将提供更详细的解释。


% \begin{enumerate} \message{set counter}%\SetCounter:item=-1
% \setcounter{enumi}{-1}
% \item\label{ini:esc} Escape character; this signals the start of a control
%       sequence. \IniTeX\ makes the backslash \verb-\- (code~92)
%       an escape character.

%       转义字符；表示控制序列的开始。\IniTeX\ 将反斜杠 \verb-\-（代码 92）作为转义字符。%0和领导，领
% \item Beginning of group; such a character causes \TeX\ to enter a new
%       level of grouping. The plain format makes the open brace \verb-{-
% \mdqon
%       a beginning"-of-group character.
% \mdqoff

% 组开始；此类字符导致 \TeX\ 进入一个新的分组级别。Plain \TeX\ 将左花括号 \verb-{-
% \mdqon
% 作为组开始字符。
% \mdqoff
% \item End of group; \TeX\ closes the current level of grouping.
%       Plain \TeX\ has  the closing brace \verb-}- as end-of-group
%       character.

%       组结束；\TeX\ 关闭当前的分组级别。Plain \TeX\ 将右花括号 \verb-}- 作为组结束字符。
% \item Math shift; this is the opening and closing delimiter for
%       math formulas. Plain \TeX\ uses the dollar sign~\verb-$-
%       for this.

%       数学模式切换；用于数学公式的开启和关闭定界符。Plain \TeX\ 使用美元符号 \verb-$-
%       作为数学模式切换符号。%3 全过来是 m,3通商
% \item Alignment tab; the column (row) separator in tables
%       made with \cs{halign} (\cs{valign}). In plain
%       \TeX\ this is the ampersand~\verb-&-.

%       对齐制表符；在使用 \cs{halign}（\cs{valign}）制作的表格中作为列（行）的分隔符。在 plain
%       \TeX\ 中，这是和号 \verb-&-。%4 和 & 很像，另&像一个人坐着，整齐的坐着。
% \item\label{ini:eol} End of line; a character that \TeX\ considers
%       to signal the
%       end of an input line.
%       \IniTeX\ assigns this code to the \gram{return}, that is, code~13.
%       Not coincidentally, 13~is also the value that \IniTeX\
%       assigns to the \cs{endlinechar} parameter; see above.
% \awp

% 行结束；\TeX\ 认为此字符表示输入行的结束。
% \IniTeX\ 将此代码分配给 \gram{return}，即代码 13。
% 巧合的是，13 也是 \IniTeX\ 分配给 \cs{endlinechar} 参数的值；参见上文。
% \awp%5 行结束 回车 5像拐
% \item Parameter character; this indicates parameters for macros.
%       In plain \TeX\ this is the hash sign~\verb-#-.

%       参数字符；用于指示宏的参数。在 plain \TeX\ 中，这是井号 \verb-#-。%6
% \item Superscript; this precedes superscript expressions 
%       in math mode. It is also used to denote character
%       codes that cannot
%       be entered in an input file; see below. 
%       In plain \TeX\ this is the circumflex~\verb-^-.

% 上标；在数学模式中用于表示上标表达式。还用于表示无法在输入文件中输入的字符代码；参见下文。
% 在 plain \TeX\ 中，这是插入符号 \verb-^-。%7上八下
% \item Subscript; this precedes subscript expressions in math mode.
%       In plain \TeX\ the underscore~\verb-_- is used for this.

%       下标；在数学模式中用于表示下标表达式。在 plain \TeX\ 中，下划线 \verb-_- 用于表示下标。%下巴
% \item Ignored; characters of this category are removed
%       from the input, and have therefore no influence on
%       further \TeX\ processing. In plain \TeX\ this is
%       the \gr{null} character, that is, code~0.

%       忽略；此类别的字符从输入中被删除，因此对后续的 \TeX\ 处理没有影响。在 plain \TeX\ 中，这是空字符，即代码 0。%9 go ignore
% \item\label{ini:sp} Space; space characters receive special treatment.
%       \IniTeX\ assigns this category to the \ascii{} \gr{space}
%       character, code~32.

%       空格；空格字符接受特殊处理。\IniTeX\ 将此类别分配给 ASCII 的空格字符，代码 32。%10 
% \item\label{ini:let} Letter; in \IniTeX\ only the characters \n{a..z}, \n{A..Z}
%       are in this category. Often, macro packages make
%       some `secret' character (for instance~\n@) into a letter.

%       字母；在 \IniTeX\ 中，只有字符 \n{a..z} 和 \n{A..Z} 属于此类别。通常，宏包会将某些“秘密”字符（例如 \n@）归类为字母。%letter 1
% \item\label{ini:other} Other; \IniTeX\ puts everything that is 
%       not in the other categories into this category. Thus
%       it includes, for instance, digits and punctuation.

%       其他；\IniTeX\ 将不属于其他类别的所有内容归类为此类别。因此，它包括数字和标点符号等内容。%other t two 2
% \item Active; active characters function as a \TeX\ command,
%       without being preceded by an escape character.
%       In plain \TeX\ this is only the tie character~\verb-~-,
%       which is defined to produce
%       an unbreakable space; see page~\pageref{tie}.

%       活动字符；活动字符充当 \TeX\ 命令，而不需要在前面加上转义字符。在 plain \TeX\ 中，只有波浪号 \verb-- 是活动字符，它被定义为生成不可分割的空格；参见第\pageref{tie} 页。%13 要生 活动
% \item\label{ini:comm} Comment character; from a comment character onwards,
%       \TeX\ considers the rest of an input line to be
%       comment and ignores it. In \IniTeX\ the  per cent sign \verb-%-
%       is made a comment character.

%       注释字符；从注释字符开始，\TeX\ 将输入行的剩余部分视为注释并忽略它。在 \IniTeX\ 中，百分号符号 \verb-%- 被设为注释字符。%14 逝
% \item\label{ini:invalid} Invalid character; this category is for characters that
%       should not appear in the input. \IniTeX\ assigns the
%       \ascii\ \gr{delete} character, code~127, to this category.

%       无效字符；此类别适用于不应出现在输入中的字符。\IniTeX\ 将 ASCII 的删除字符，即代码 127，归类为此类别。%15 妖 无
% \end{enumerate}

% The user can change the mapping 
% of character codes to category codes
% with the \cstoidx catcode\par\ command (see Chapter~\ref{gramm}
% for the explanation of concepts such as~\gr{equals}):

% 用户可以使用命令（参见第~\ref{gramm}~章中的\gr{equals}解释）来更改字符代码到类别代码的映射：
% \begin{disp}\cs{catcode}\gram{number}\gr{equals}\gram{number}.\end{disp}
% In such a statement, the first number is often given in the form

% 在这样的语句中，第一个数字通常以以下形式给出：
% \begin{disp}\verb>`>\gr{character}\quad or\quad \verb>`\>\gr{character}\end{disp}
% both of which denote the character code of the character
% (see pages \pageref{char:code} and~\pageref{int:denotation}).

% 这两种形式都表示字符的字符代码（参见第\pageref{char:code}页和\pageref{int:denotation}页）。

% Plain格式定义了\csterm active \par（活动字符）\hfill The plain format defines
% \csterm active\par
% \begin{verbatim}
% \chardef\active=13
% \end{verbatim} 
% 这样，我们可以编写如下语句：\hfill so that one can write statements such as
% \begin{verbatim}
% \catcode`\{=\active
% \end{verbatim}
% The \cs{chardef} command is  treated
% on pages \pageref{chardef} and~\pageref{num:chardef}.

% 关于\cs{chardef}命令的处理可以参考第\pageref{chardef}页和\pageref{num:chardef}页。


% The \LaTeX\ format has the control sequences

% \LaTeX\ 格式提供了以下控制序列：
% \begin{verbatim}
% \def\makeatletter{\catcode`@=11 }
% \def\makeatother{\catcode`@=12 }
% \end{verbatim}
% in order to switch on and off the `secret' character~\n@
% (see below).
% \awp

% 以便打开和关闭“秘密”字符~\n@（见下文）。
% \awp

      

% The \cs{catcode} command can also be used to query category
% codes: in 

% \cs{catcode}命令还可以用于查询类别代码：\begin{verbatim}
% \count255=\catcode`\{
% \end{verbatim}
% it yields a number, which can be assigned.

% 它将返回一个数字，可以进行赋值。

% Category codes can be tested by

% 测试类别代码可以通过:
% \begin{disp}\cs{ifcat}\gr{token$_1$}\gr{token$_2$}\end{disp}
% \TeX\ expands whatever is after \cs{ifcat} until two 
% unexpandable tokens are found; these are then compared
% with respect to their category codes. Control sequence
% tokens are considered to have category code~16,
% which makes them all equal to each other, and unequal to
% all character tokens.
% Conditionals are treated further in Chapter~\ref{if}.

% \TeX\ 会展开\cs{ifcat}后面的内容，直到找到两个不可展开的记号；然后它们将根据它们的类别代码进行比较。控制序列记号被认为具有类别代码16，这使得它们彼此相等，并且与所有字符记号都不相等。
% 条件语句将在第\ref{if}~章进一步讨论。


% %\point From characters to tokens
% \section{From characters to tokens\\从字符到记号}

% The input processor
% of \TeX\ scans input lines from a file or from the
% user terminal, and converts the characters in the input
% to tokens. There are three types of tokens.

% \TeX\ 的输入处理器从文件或用户终端扫描输入行，并将输入中的字符转换为记号。记号有三种类型。
% \begin{itemize}\item Character tokens: any character that is
% 	passed on its own to \TeX's
% further levels of processing with an appropriate
% category code attached.

% 字符记号：任何以适当的类别码单独传递给 \TeX\ 的进一步处理层级的字符。
% \item Control sequence tokens, of which there are two kinds:
% 	an escape character 
% \ldash that is,\message{ldash nobreak?}
% a character of category~0 \rdash  followed
% by a string of `letters' is
% lumped together into a {\em control word}, which is a single token.
% An escape character followed by a single character that is not of
% category~11, letter, is made into a 
% {\em control symbol}\term control! symbol\par.
% If the distinction between control word and control symbol is
% irrelevant, both are called 
% {\em control sequences}\term control! sequence\par.

% The control symbol that results from an escape character followed
% \csterm \char32\par
% by a space character is called 
% {\em control space}\term control! space\par.

% 控制序列记号，有两种类型： \begin{itemize}
%       \item 以转义字符（类别码为 0 的字符）开头，后跟一串“字母”的字符串，被组合成一个{\em 控制词}，成为单个记号。
%       \item 转义字符后跟一个非类别码为 11（字母）的单个字符，被组合成一个{\em 控制符号}\term control! symbol\par。
%       \end{itemize}
%       如果控制词和控制符号之间的区别无关紧要，两者都被称为{\em 控制序列}\term control! sequence\par。
      
%       转义字符后跟一个空格字符的控制符号被称为{\em 控制空格}\term control! space\par。

% \item Parameter tokens: a parameter character 
% 	\ldash that is, a character of category~6, by default~\verb=#= \rdash 
% followed by a digit \n{1..9} is replaced by a parameter token.
% Parameter tokens are allowed only in the context of
% macros (see Chapter~\ref{macro}).

% A macro parameter character followed by another macro parameter
% character (not necessarily with the same character code)
% is replaced by a single character token.
% This token has category~6 (macro parameter), and the character
% code of the second parameter character.
% The most common instance is of this is
% replacing \n{\#\#} by~\n{\#$_6$}, where the subscript
% denotes the category code.

% 参数记号：参数字符（默认为 \verb=#=，类别码为 6 的字符）后跟一个数字 \n{1..9}，被替换为一个参数记号。
% 参数记号只允许在宏的上下文中使用（参见第~\ref{macro}~章）。

% 以宏参数字符开头，后跟另一个宏参数字符（不一定具有相同的字符码）的记号将被替换为单个字符记号。
% 该记号的类别码为 6（宏参数），字符码为第二个参数字符的字符码。
% 最常见的情况是将 \n{\#\#} 替换为~\n{\#$_6$},其中下标表示类别码。
% \end{itemize}


% %\point[input:states] The input processor as a finite state automaton
% \section{The input processor as a finite state automaton\\输入处理器作为有限状态自动机}
% \label{input:states}

% \TeX's input processor can be considered to be a finite state 
% automaton with three internal states,
% that is, at any moment in time it is in one of three states,
% \term state! internal\par
% and after transition to another state there is no memory of the
% \awp
% previous states. 

% \TeX 的输入处理器可以看作是一个有三个内部状态的有限状态自动机，也就是说，在任何时刻它都处于三个状态之一，且在转换到另一个状态后，不记忆先前的状态。


% %\spoint State {\italic N}: new line
% \subsection{State {\italic N}: new line\\状态 {\italic N}：新行}

% State {\italic N} is entered at the beginning of each new input line,
% and that is the only time \TeX\ is in this state.
% In state~{\italic N} all space tokens (that is, characters of category~10)
% are ignored; an end-of-line character is converted
% into a \cs{par} token.
% All other tokens bring \TeX\ into state~{\italic M}.

% 状态 {\italic N} 在每个新输入行的开头进入，并且在这个状态下，\TeX{} 只会在这个时刻出现。在状态 {\italic N} 中，所有空格记号（即，类别码为 10 的字符）都被忽略；换行符被转换为一个 \cs{par} 记号。其他所有记号都将使 \TeX{} 进入状态 {\italic M}。


% %\spoint State {\italic S}: skipping spaces
% \subsection{State {\italic S}: skipping spaces\\状态 {\italic S}：跳过空格}

% State {\italic S} is entered in any mode after a control word or
% control space (but after no other control symbol),
% or, when in state~{\italic M}, after a space.
% In this state all subsequent spaces or end-of-line characters
% in this input line are discarded.

% 状态 {\italic S} 在任何模式下进入，紧跟在控制词或控制空格之后（但不跟在其他控制符号之后），或者在状态 {\italic M} 下跟在一个空格之后。在这个状态下，当前输入行中的所有后续空格或换行符都被丢弃。

% %\spoint State {\italic M}: middle of line
% \subsection{State {\italic M}: middle of line\\状态 {\italic M}：行中部分}

% By far the most common state is~{\italic M}, `middle of line'.
% It is entered after characters of categories
% 1--4, 6--8, and 11--13, and after control symbols
% other than control space.
% An end-of-line character encountered in this state
% results in a space token.

% 远远最常见的状态是 {\italic M}，即“行中部分”。在类别码为 1--4、6--8 和 11--13 的字符之后，以及除控制空格之外的其他控制符号之后，进入此状态。在此状态下遇到换行符会生成一个空格记号。

% \input figflow \message{left align flow diagram}
% \vskip12pt plus 1pt minus 4pt\relax %before spoint skip
% \begin{tdisp}%\PopIndentLevel
% \leavevmode\relax
% %\figmouth
% \message{fig mouth missing}
% \end{tdisp}



% %\point[hathat] Accessing the full character set
% \section{Accessing the full character set\\访问完整字符集}
% \label{hathat}

% Strictly speaking, \TeX's input processor
% is not a finite state automaton.
% This is because during the scanning of the input line
% all trios consisting of two {\sl equal\/} superscript characters 
% \term \char94\char94\ replacement\par
% (category code~7) and a subsequent character
% (with character code~$<128$)
% are replaced by a single character with a character
% code in the range 0--127,
% differing by 64 from that of the original character.

% 严格来说，\TeX 的输入处理器并不是一个有限状态自动机。
% 这是因为在扫描输入行时，所有由两个{\sl 相等的}上标字符
% \term \char94\char94\ replacement\par
% （类别码 7）和后续字符（字符代码 $<128$）
% 组成的三元组，都会被替换为一个字符，其字符代码在 0--127 范围内，
% 与原始字符的字符代码相差 64。

% This mechanism can be used, for instance, to access positions in a font
% corresponding to character codes that cannot
% be input, for instance because they are \ascii{} control characters.
% The most obvious examples are the \ascii{} \gr{return}
% and \gr{delete} characters; the corresponding 
% positions 13 and 127 in a font are
% accessible as \verb>^^M> and~\verb>^^?>.
% However, since the category of \verb>^^?> is 15, invalid,
% that has to be changed before character 127 can be accessed.
% \awp

% 这个机制可以用来访问与无法输入的字符代码对应的字体位置，
% 例如因为它们是 \ascii{} 控制字符而无法输入。
% 最明显的例子是 \ascii{} 的回车符和删除符；
% 字体中对应的位置 13 和 127 可以分别通过 \verb>^^M> 和 \verb>^^?> 访问。
% 然而，由于 \verb>^^?> 的类别码是 15，即无效的，
% 必须在访问字符 127 之前将其更改。
% \awp

% In \TeX3 this mechanism has been 
% modified and extended to access 256 characters:
% any quadruplet \verb-^^xy- where both \n x and \n y are lowercase
% hexadecimal digits \n0--\n9, \n a--\n f, 
% is replaced by a character in the
% range 0--255, namely the character the number of which is
% represented hexadecimally as~\n{xy}.
% This imposes a slight restriction on the applicability
% of the earlier mechanism: if, for instance, \verb>^^a>
% is typed to produce character~33, then a following
% \n0--\n9, \n{a}--\n{f} will be misunderstood.

% 在 \TeX3 中，这个机制已经被修改和扩展，以访问 256 个字符：
% 任何由小写十六进制数字 \n0--\n9、\n a--\n f 组成的四元组 \verb-^^xy-，
% 都会被替换为范围在 0--255 的字符，即其十六进制表示的数字为 \n{xy} 的字符。
% 这对于早期机制的适用性有一点限制：
% 例如，如果键入 \verb>^^a> 来生成字符 33，
% 那么后面的 \n0--\n9、\n{a}--\n{f} 将会被误解。

% While this process makes \TeX's input processor
% somewhat more powerful
% than a true finite state automaton,
% it does not interfere with the rest of
% the scanning. Therefore it is conceptually simpler to pretend that
% such a replacement of triplets or quadruplets
% of characters, starting with~\verb>^^>, is performed in advance. 
% In actual practice this is not possible,
% because an
% input line may assign category code~7 to some 
% character other than the circumflex, thereby 
% influencing its further processing.

% 在这个过程中，\TeX 的输入处理器比真正的有限状态自动机更强大一些，但它不会干扰其余的扫描过程。因此，在概念上更简单的做法是假装事先进行这种以\verb>^^>开头的字符三元组或四元组的替换。实际上，这是不可能的，因为输入行可能会将类别码为7的字符分配给除了插入符号之外的某些字符，从而影响其进一步处理。



% %\point Transitions between internal states
% \section{Transitions between internal states\\内部状态之间的转换}

% Let us now discuss the effects on the internal state
% of \TeX's input processor when
% certain category codes are encountered in the input. 

% 现在让我们讨论当输入中出现某些类别码时，对\TeX 的输入处理器的内部状态产生的影响。


% %\spoint 0: escape character
% \subsection{0: escape character\\0: 转义字符}%0 圈 转圈圈 转义

% When an escape character is encountered\term character !escape\par,
% \TeX\ starts forming a control sequence token.
% Three different types of control sequence can result,
% depending on the category code of the character that
% follows the escape character.

% 当遇到转义字符时\term 转义字符 !escape\par，\TeX 会开始形成一个控制序列记号。根据转义字符后面的字符的类别码，可以得到三种不同类型的控制序列。

% \begin{itemize}\item
% If the character following the escape is of category~11,
% letter, then \TeX\ combines the escape,
% that character and all following
% characters of category~11, into a control word.
% After that \TeX\
% goes into state~{\italic S}, skipping spaces.

% 如果转义字符后面的字符是类别码为11的字母，则\TeX 会将转义字符、该字符以及所有后续的类别码为11的字符组合成一个控制词。之后，\TeX 进入状态{\italic S}，跳过空格。
% \item
% With a character of category~10, space,
% a control symbol called control space results, 
% and \TeX\ goes into state~{\italic S}.

% 如果转义字符后面的字符是类别码为10的空格，则得到一个称为控制空格的控制符号，\TeX 进入状态{\italic S}。
% \item
% With a character of any other category code 
% a control symbol results, and \TeX\ goes into state~{\italic M},
% middle of line.

% 如果转义字符后面的字符是其他任何类别码的字符，则得到一个控制符号，\TeX 进入状态{\italic M}，即行中间状态。
% \end{itemize}


% The letters of a control sequence name have to be all on one line;
% a control sequence name is not continued on the next line
% if the current line ends with a comment sign, or if (by letting
% \cs{endlinechar} be outside the range~0--255) 
% there is no terminating character.

% 控制序列名必须全部位于同一行；如果当前行以注释符结束，或者（通过使 \cs{endlinechar} 超出范围 0--255）没有终止字符，则控制序列名不会延续到下一行。

% %\spoint 1--4, 7--8, 11--13: non-blank characters
% \subsection{1--4, 7--8, 11--13: non-blank characters\\1--4, 7--8, 11--13：非空格字符}

% Characters of category codes 1--4, 7--8, and 11--13 are made
% into tokens, and \TeX\ goes into state~{\italic M}.

% 类别码为 1--4、7--8 和 11--13 的字符被转换为记号，\TeX\ 进入状态 {\italic M}。



% %\spoint 5: end of line
% \subsection{5: end of line\\行尾}% 尾 wei w wu 5

% Upon encountering an end-of-line character, 
% \TeX\ discards the rest of the
% line, and starts processing the next line,
% in state~{\italic N}. If the current state was~{\italic N},
% \awp
% that is, if the
% line so far contained at most spaces, a~\cs{par} token
% is inserted; if the state was~{\italic M}, a~space token is inserted,
% and in state~{\italic S} nothing is inserted.

% 遇到行终止符时，\TeX\ 会丢弃当前行的剩余部分，并开始处理下一行，进入状态 {\italic N}。如果当前状态为 {\italic N}，也就是说，到目前为止的行最多只包含空格，那么会插入一个 \cs{par} 记号；如果状态为 {\italic M}，则插入一个空格记号；而在状态 {\italic S} 下则不插入任何记号。

% Note that by `end-of-line character' a character with category
% code~5 is meant. This is not necessarily the \cs{endlinechar},
% nor need it appear at the end of the line.
% See below for further remarks on line ends.

% 请注意，“行终止符”指的是类别码为 5 的字符。它不一定是 \cs{endlinechar}，也不一定出现在行末。有关行尾的进一步说明，请参见下文。

% %\spoint 6: parameter
% \subsection{6: parameter\\6：参数}

% Parameter characters \ldash usually~\verb=#= \rdash  can be
% \term character !parameter\par
% followed by either a digit \n{1..9} 
% in the context of macro definitions
% \altt
% or by another parameter character. 
% In the first case a `parameter token' results,
% in the second case only a single parameter character
% is passed on as a character token for further processing.
% In either case \TeX\ goes into state~{\italic M}.

% 参数字符（通常为 \verb=#=）可以后跟宏定义上下文中的数字 \n{1..9}，也可以后跟另一个参数字符。
% 在第一种情况下，会产生一个“参数记号”，在第二种情况下，只有一个单独的参数字符作为字符记号传递给进一步处理。
% 在任一情况下，\TeX\ 进入状态 {\italic M}。

% A parameter character can also appear on its own in an
% alignment preamble (see Chapter~\ref{align}).

% 参数字符还可以在对齐前导中单独出现（参见第~\ref{align}~章）。


% %\spoint 7: superscript
% \subsection{7: superscript\\7: 上标}

% A superscript character is handled like most non-blank
% characters, except in the case where it is followed
% by a  superscript character of the same character code.
% The process
% that replaces these two characters plus the following character
% (possibly two characters in \TeX3) by another character
% was described above.

% 处理上标字符与大多数非空白字符相同，除非它后面跟着一个相同字符编码的上标字符。这个过程会将这两个字符以及后面的字符（在 \TeX3 中可能是两个字符）替换为另一个字符，这个过程在前面已经描述过。



% %\spoint 9: ignored character
% \subsection{9: ignored character\\9: 忽略字符}

% Characters of category 9 are ignored; \TeX\ remains in the same state.

% 类别码为 9 的字符会被忽略；\TeX{} 保持在相同的状态中。


% %\spoint 10: space
% \subsection{10: space\\10: 空格}

% A token with category code 10 \ldash this is called a \gr{space token},
% irrespective of the character code \rdash 
% is ignored in states {\italic N} and~{\italic S} 
% (and the state does not change); 
% in state~{\italic M} \TeX\ goes into state~{\italic S}, inserting
% a token that has category~10 and character code~32 
% (\ascii{} space)\term character !space\par,
% that is, the character code of the space token may change
% from the character that was actually input.

% 具有类别码为 10 的记号（称为 \gr{space token}）在状态 {\italic N} 和 {\italic S} 中被忽略（状态不会改变）；在状态 {\italic M} 中，\TeX{} 进入状态 {\italic S}，插入一个类别码为 10 和字符编码为 32（\ascii{} 空格）的记号\term{字符 !space}，也就是说，空格记号的字符编码可能会与实际输入的字符不同。


% %\spoint 14: comment
% \subsection{14: comment\\14: 注释}

% A comment character causes \TeX\ to discard 
% the rest of the line, including the comment character.
% In particular, the end-of-line character is not seen,
% so even if the comment was encountered in state~{\italic M}, no space
% token is inserted.

% 注释字符会导致 \TeX{} 丢弃行的其余部分，包括注释字符本身。特别地，换行符不可见，因此即使在状态 {\italic M} 中遇到注释，也不会插入空格记号。
% %\spoint 15: invalid
% \subsection{15: invalid\\15: 无效字符}

% Invalid characters cause an error message. \TeX\ remains in
% the state it was in.
% However, in the context of a control symbol an invalid character
% is acceptable. Thus \verb>\^^?> does not cause any error messages.
% \awp

% 无效字符会引发错误消息。\TeX{} 保持在原来的状态中。然而，在控制符号的上下文中，无效字符是可接受的。因此，\verb>^^?> 不会引发任何错误消息。



% %\point[cat12] Letters and other characters
% \section{Letters and other characters\\字母和其他字符}
% \label{cat12}

% In most programming languages identifiers can consist
% of both letters and digits (and possibly some other
% character such as the underscore), but control sequences in \TeX\
% are only allowed to be formed out of characters of category~11,
% letter. Ordinarily, the digits and punctuation symbols have
% category~12, other character.
% However, there are contexts where \TeX\ itself
% generates a string of characters, all of which have
% category code~12, even if that is not their usual
% category code.

% 在大多数编程语言中，标识符可以由字母和数字（以及可能的其他字符，如下划线）组成，
% 但是在 \TeX\ 中，控制序列只能由类别码为 11 的字母字符构成。
% 通常，数字和标点符号的类别码为 12，表示其他字符。
% 然而，在某些上下文中，即使这些字符的通常类别码不是 12，\TeX\ 本身也会生成一串类别码为 12 的字符。

% This happens when the operations 
% \cs{string},
% \cs{number},
% \cs{romannumeral},
% \cs{jobname},
% \cs{fontname},
% \cs{meaning},
% and \cs{the}
% are used to generate a stream of character tokens.
% If any of the characters delivered by such a command
% is a space character (that is, character code~32), 
% it receives category code~10, space.

% 当使用操作符 \cs{string}、\cs{number}、\cs{romannumeral}、\cs{jobname}、\cs{fontname}、\cs{meaning} 和 \cs{the} 生成一串字符记号时，就会发生这种情况。
% 如果由此类命令提供的任何字符是空格字符（即字符代码为 32），它将获得类别码为 10，表示空格。

% For the extremely rare case where a hexadecimal digit has been
% hidden in a control sequence, \TeX\ allows \n A$_{12}$--\n F$_{12}$
% to be hexadecimal digits, in addition to the ordinary
% \n A$_{11}$--\n F$_{11}$ (here
% the subscripts denote the category codes).

% 对于极为罕见的情况，即十六进制数字被隐藏在控制序列中的情况，
% \TeX\ 允许 \n A${12}$--\n F${12}$ 作为十六进制数字，除了常规的 \n A${11}$--\n F${11}$（这里下标表示类别码）。



% 例如， \hfill For example,
% \begin{disp}\verb>\string\end>\quad 生成四个字符记号 gives four character tokens\quad
% \n{\char92$_{12}$e$_{12}$n$_{12}$d$_{12}$} \end{disp}
% 请注意，\hfill Note that

% \n{\char92$_{12}$}\term character !escape\par\label{use:escape}
% is used in the output only because the
% value of \cs{escapechar} is the character code for the
% backslash. Another value of \cs{escapechar} leads to another
% character in the output of \cs{string}. 
% The \cs{string} command is treated further in Chapter~\ref{char}.

% \n{\char92$_{12}$}\term character !escape\par\label{use:escape}
% 仅在输出中使用，因为 \cs{escapechar} 的值是反斜杠的字符代码。
% \cs{escapechar} 的另一个值会导致 \cs{string} 输出中的另一个字符。
% \cs{string} 命令将在第~\ref{char} 章进一步讨论。

% 空格可能出现在控制序列中：\hfill Spaces can wind up in control sequences:
% \begin{disp}\verb>\csname a b\endcsname>\end{disp} gives a control sequence
% token in which one of the three characters is a space.
% Turning this control sequence token into a string of characters

% 生成一个控制序列记号，其中三个字符之一是空格。
% 将此控制序列记号转换为一串字符
% \begin{disp}\verb>\expandafter\string\csname a b\endcsname>\end{disp}
% 得到 gives 
% \n{\char92$_{12}$a$_{12}$\char32$_{10}$b$_{12}$}.


% As a more practical example, suppose there exists a sequence
% of input files \n{file1.tex}, \n{file2.tex}\label{ex:jobnumber},
% and we want to
% write a macro that finds the number of the input file
% that is being processed. One approach would be to write

% 作为一个更实际的例子，假设存在一系列输入文件 \n{file1.tex}、\n{file2.tex}\label{ex:jobnumber}，我们想要编写一个宏来找出正在处理的输入文件的编号。一种方法是编写以下代码：
% \begin{verbatim}
% \newcount\filenumber  \def\getfilenumber file#1.{\filenumber=#1 }
% \expandafter\getfilenumber\jobname.
% \end{verbatim}
% where the letters \n{file} in the parameter text of the
% macro (see Section~\ref{param:text}) absorb that part of the
% jobname, leaving the number as the sole parameter.

% 在宏的参数文本中，字母 \n{file}（参见第~\ref{param:text}~节）吸收了作业名的那部分，将编号作为唯一参数。

% However, this is slightly incorrect: the letters \n{file} resulting
% from the \cs{jobname} command have category code~12, instead of
% 11 for the ones in the definition of \cs{getfilenumber}.
% This can be repaired as follows:

% 然而，这有点不正确：\cs{jobname} 命令生成的字母 \n{file} 的类别码是12，而不是 \cs{getfilenumber} 宏定义中的类别码11。可以通过以下方式进行修复：
% \begin{verbatim}
% {\escapechar=-1
%  \expandafter\gdef\expandafter\getfilenumber
%        \string\file#1.{\filenumber=#1 }
% }
% \end{verbatim}
% \awp
% Now the sequence \verb>\string\file> gives the four
% letters \n{f$_{12}$i$_{12}$l$_{12}$e$_{12}$}; 
% the \cs{expandafter} commands let this be executed prior to
% the macro definition;
% the backslash is omitted because we put \verb>\escapechar=-1>.
% Confining this value to a group makes it necessary to use~\cs{gdef}.

% 现在，序列 \verb>\string\file> 得到的是四个字母 \n{f${12}$i${12}$l${12}$e${12}$}；\cs{expandafter} 命令使其在宏定义之前执行；由于我们设置了 \verb>\escapechar=-1>，所以省略了反斜杠。将该值限定在一个组中，需要使用~\cs{gdef}。



% %\global\def\pppar.{\par}
% %\point The \lowercase{\n{\char92par}} token
% \section{The \lowercase{\n{\char92par}} token\\\lowercase{\n{\char92par}} 记号}

% \TeX\ inserts a \cstoidx par\par\ token into the input after
% \term line !empty\par
% encountering a character with category code~5,
% end of line, in state~{\italic N}.
% It is good to realize when exactly this happens:
% since \TeX\ leaves state~{\italic N}
% when it encounters any token but a space,
% a~line giving a \cs{par} can only contain characters
% of category~10. In particular, it cannot end with a comment
% character. Quite often this fact is used the other way around:
% if an empty line is wanted for the layout of the input
% one can put a comment sign on that line.

% 在状态为 {\italic N} 时，\TeX\ 在遇到类别码为 5 的字符（行尾）后会将一个 \cstoidx par\par 记号插入输入中。了解这个发生的准确时机很重要：由于 \TeX\ 在遇到除空格以外的任何记号时都会离开状态 {\italic N}，包含 \cs{par} 的行只能包含类别码为 10 的字符。特别要注意的是，行不能以注释字符结尾。通常情况下，这个事实可以反过来使用：如果希望在输入的布局中使用空行，可以在该行上加上注释符号。

% Two consecutive empty lines generate two \cs{par} tokens.
% For all practical purposes this is equivalent to one \cs{par},
% because after the first one \TeX\ enters vertical mode, and
% in vertical mode a \cs{par} only
% exercises the page builder,
% and clears the paragraph shape parameters.

% 连续两个空行会生成两个 \cs{par} 记号。在实际应用中，这与一个 \cs{par} 是等效的，因为在第一个 \cs{par} 后，\TeX\ 进入垂直模式，而在垂直模式下，\cs{par} 只会触发页面生成器，并清除段落形状参数。

% A \cs{par} is also inserted into the input when \TeX\ sees a
% \gram{vertical command} in unrestricted horizontal mode.
% After the \cs{par} has been read and expanded, the
% vertical command is examined anew (see Chapters~\ref{hvmode}
% and~\ref{par:end}).

% 当 \TeX\ 在无限水平模式中看到 \gram{vertical command} 时，也会将一个 \cs{par} 插入输入。在读取和展开 \cs{par} 后，会重新检查垂直命令（参见第~\ref{hvmode}章和第\ref{par:end}~章）。

% The \cs{par} token may also be inserted by the \cs{end}
% command that finishes off the run of \TeX; see Chapter~\ref{output}.

% 在 \TeX\ 的运行结束时，通过 \cs{end} 命令插入 \cs{par} 记号；详见第~\ref{output}~章。

% It is important to realize that \TeX\ does what it normally does
% when encountering an empty line
% (which is ending a paragraph)
% only because of the default definition of the \cs{par} token.
% By redefining \cs{par} the behaviour
% caused by empty lines and vertical commands can be changed completely,
% and  interesting special effects can be achieved.
% In order to continue to be able  to cause the actions normally
% associated with \cs{par}, the synonym \cs{endgraf} is
% available in the plain format. See further Chapter~\ref{par:end}.

% 重要的是要意识到，\TeX\ 在遇到空行时所做的通常操作（即结束段落）仅因为 \cs{par} 记号的默认定义。通过重新定义 \cs{par}，可以完全改变空行和垂直命令引起的行为，并实现有趣的特殊效果。为了仍然能够引发通常与 \cs{par} 相关的操作，plain 格式中提供了同义词 \cs{endgraf}。更多信息请参见第~\ref{par:end}~章。

% The \cs{par} token is not allowed to be part of a macro
% argument, unless the macro has been declared to be \cs{long}.
% A \cs{par} in the argument of a non-\cs{long} macro
% prompts \TeX\ to give a `runaway argument' message.
% Control sequences that have been \cs{let} to \cs{par}
% (such as \cs{endgraf}) are allowed, however.

% 在非 \cs{long} 宏的参数中，不允许包含 \cs{par} 记号，否则 \TeX\ 会给出“runaway argument”（参数溢出）的错误消息。但是，允许使用 \cs{let} 给予 \cs{par} 的控制序列（例如 \cs{endgraf}）。
 


% %\point Spaces
% \section{Spaces\\空格}

% This section treats some of the aspects of
% \term token !space\par
% space characters and space tokens in the initial processing
% stages of \TeX. The topic of spacing in text typesetting
% is treated in Chapter~\ref{space}.

% 本节介绍 \TeX 在初始处理阶段中处理空格字符和空格记号的一些方面。关于文本排版中的间距问题会在第~\ref{space} 章中详细讨论。
% %\spoint Skipped spaces
% \subsection{Skipped spaces\\跳过的空格}

% From the discussion of the internal states of \TeX's 
% input processor
% it is clear that some spaces in the input never reach the
% \awp
% output; in fact they never get past the input processor.
% These are for instance the spaces at the beginning
% of an input line, and the spaces following the one
% that lets \TeX\ switch to state~{\italic S}.

% 从 \TeX 的输入处理器的内部状态的讨论中可以看出，输入中的某些空格永远不会到达输出；事实上，它们甚至无法通过输入处理器。例如，在输入行的开头的空格以及让 \TeX{} 切换到状态 {\italic S} 后的空格都属于此类空格。


% On the other hand, line ends can generate spaces (which are not
% in the input) that may wind up in the output.
% There is a third kind of space: the spaces that get past the
% input processor,
% or are even generated there, but still do not wind up in the
% output. These are the \gram{optional spaces} that the 
% syntax of \TeX\ allows in various places.

% 另一方面，换行符可能会生成（未在输入中的）空格，这些空格可能最终出现在输出中。还有第三种空格：那些通过输入处理器、甚至在其中生成的空格，但最终不会出现在输出中。这些是 \TeX{} 语法在各个位置允许的 \gram{optional spaces}（可选空格）。


% %\spoint Optional spaces
% \subsection{Optional spaces\\可选空格}

% The syntax of \TeX\ has the concepts of `optional spaces'
% \term space! optional \par
% and `one optional space':

% \TeX\ 的语法中有“可选空格”\term 空格!可选的 \par 和“一个可选空格”的概念：
% \begin{disp}\gr{one optional space} $\longrightarrow$
% \gr{space token} $|$ \gr{empty}\nl
% \gr{optional spaces} $\longrightarrow$
% \gr{empty} $|$ \gr{space token}\gr{optional spaces}\end{disp}
% In general, \gr{one optional space} is allowed after
% numbers and glue specifications, while \gr{optional spaces} are
% allowed whenever a space can occur inside a number
% (for example, between a minus sign and the digits of the number)
% or glue specification (for example, between \n{plus} and \n{1fil}).
% Also, the definition of \gr{equals} allows \gr{optional spaces}
% before the \n= sign.

% 一般来说，在数字和粘连规范之后可以有 \gr{one optional space}，
% 而在数字内部（例如在负号和数字之间）或粘连规范内部（例如在 \n{plus} 和 \n{1fil} 之间）可以有 \gr{optional spaces}。
% 此外，在\gr{equals} 的定义中允许在等号 \n= 之前有 \gr{optional spaces}。

% Here are some examples of optional spaces.

% 下面是一些可选空格的示例。



% \begin{itemize} 
% \item A number can be delimited by \gr{one optional space}. 
% This prevents accidents (see Chapter~\ref{number}), 
% and it speeds up processing, as \TeX\ can 
% detect more easily where the \gram{number} being read ends.
% Note, however, that not every `number' is a \gram{number}:
% for instance the {\tt 2} in \cs{magstep2} is not a number,
% but the  single token that is the parameter of the
% \cs{magstep} macro. Thus a space or line end after this
% is significant. Another example is a parameter number,
% for example~\n{\#1}: since at most nine parameters are allowed, scanning
% one digit after the parameter character suffices.

% 数字可以由 \gr{one optional space} 来界定。
% 这可以避免错误（参见第~\ref{number} 章），
% 并且加快处理速度，因为 \TeX\ 可以更容易地检测出正在读取的 \gram{number} 的结束位置。
% 但是请注意，并不是每个“数字”都是 \gram{number}：
% 例如，\cs{magstep2} 中的 {\tt 2} 不是一个数字，
% 而是作为 \cs{magstep} 宏的参数的单个记号。
% 因此，在此之后的空格或行结束符是有意义的。
% 另一个例子是参数编号，例如~\n{\#1}：
% 由于最多只允许九个参数，因此在参数字符之后扫描一个数字即可。

% \item From the grammar of \TeX\ 
% it follows that the
% keywords \n{fill} and \n{filll}
% consist of \n{fil} and
% separate {\tt l}$\,$s, each of which is a keyword
% (see page~\pageref{keywords} for a more elaborate discussion),
% and hence can be followed by optional spaces. 
% Therefore forms such as \hbox{\n{fil L l}} are also valid.
% This is a potential source of strange accidents.
% In most cases, appending a \cs{relax} token prevents
% such mishaps.

% 根据 \TeX\ 的语法，
% 关键词 \n{fill} 和 \n{filll} 由 \n{fil} 和
% 单独的 {\tt l}$,$s 组成，每个都是一个关键词
% （有关更详细的讨论，请参见第~\pageref{keywords} 页），
% 因此可以在后面跟随可选空格。
% 因此，形如 \hbox{\n{fil L l}} 的形式也是有效的。
% 这可能会导致奇怪的错误。
% 在大多数情况下，添加一个 \cs{relax} 记号可以防止这种意外发生。
% \item The primitive command \cstoidx ignorespaces\par\ 
% may come in handy as the final command in a macro definition.
% As it gobbles up
% optional spaces, it can be used to prevent spaces following the
% closing brace of an argument from winding up in the output
% inadvertently. For example, in

% 原始命令 \cstoidx ignorespaces\par
% 可以作为宏定义的最后一个命令非常有用。
% 由于它会吞掉可选空格，因此可以用于防止参数的右花括号后面的空格无意中出现在输出中。
% 例如，在以下代码中：
% \begin{verbatim}
% \def\item#1{\par\leavevmode
%     \llap{#1\enspace}\ignorespaces}
% \item{a/}one line \item{b/} another line \item{c/}
% yet another
% \end{verbatim} 
% the \cs{ignorespaces} prevents spurious
% spaces in the second and third item.
% An empty line
% after \cs{ignorespaces} will still insert a \cs{par}, however.

% \cs{ignorespaces} 防止第二个和第三个条目中出现不必要的空格。
% 但是，在 \cs{ignorespaces} 之后的空行仍然会插入一个 \cs{par}。
% \end{itemize}
% \awp

