% % !TeX root = tcolorbox.tex
% include file of tcolorbox.tex (manual of the LaTeX package tcolorbox)
% \clearpage
% Saving and Loading of Verbatim Texts
\section{抄录文本的保存和加载}%
\tcbset{external/prefix=external/verbatim_}%
\begin{stripedbox}
The following macros are slightly modified versions of the original macros
from the known packages |moreverb| and |verbatim|.
They are used implicitly inside of a |tcolorbox| environment,
but they can be used outside also.
\tcblower
下面的宏是对 从 |moreverb| 和 |verbatim| 的宏稍加修改的版本。%
它们在 |tcolorbox| 环境中隐式使用，但它们也可以在之外使用。
\end{stripedbox}

% \enlargethispage*{1.5cm}

\begin{docEnvironment}{tcbverbatimwrite}{\marg{file name}}
\begin{stripedbox}
Saves the \meta{environment content} to a file named by \meta{file name}.
\TeX\ macros inside the environment are not expanded.
\tcblower
将\meta{environment content}保存到一个由\meta{file name}命名的文件中。%
环境中的\TeX\ 宏不会被展开。
\end{stripedbox}

\begin{dispExample}
\begin{tcbverbatimwrite}{\jobname_verbexp.tex}
被保存的文本
\end{tcbverbatimwrite}

现在，我们正在使用该文件:\par
\input{\jobname_verbexp.tex}
\end{dispExample}

\begin{stripedbox}
This environment may be used inside an own environment. Note, that inside
the environment definition |\tcbverbatimwrite| has to be used instead of
|\begin{tcbverbatimwrite}| and |\endtcbverbatimwrite| instead of |\end{tcbverbatimwrite}|.
\tcblower
该环境可以在已有的环境中使用。%
注意，在定义新环境时，需要使用 |\tcbverbatimwrite| 和 |\endtcbverbatimwrite| 代替 |\begin{tcbverbatimwrite}| 和 |\end{tcbverbatimwrite}|。
\end{stripedbox}

\begin{dispExample}
\newenvironment{myverbatim}{%
  \begingroup\tcbverbatimwrite{\jobname_myverb.tex}}%
  {\endtcbverbatimwrite\endgroup}

\begin{myverbatim}
  This is the text which is saved by my own environment.
\end{myverbatim}

Now, we are using the file:\par
\input{\jobname_myverb.tex}
\end{dispExample}
\end{docEnvironment}

\begin{docEnvironment}{tcbwritetemp}{}
\begin{stripedbox}
Has the same function as \refEnv{tcbverbatimwrite}, but uses the key value
of |tempfile| for the file name.
\tcblower
具有与\refEnv{tcbverbatimwrite}相同的功能，但使用|tempfile|的键值作为文件名。
\end{stripedbox}

\begin{dispExample}
\begin{tcbwritetemp}
  This text is saved \textit{as is}.
\end{tcbwritetemp}

Now, we are using the file:\par
\tcbusetemp
\end{dispExample}
\end{docEnvironment}


\begin{docCommand}{tcbusetemp}{}
\begin{stripedbox}
Loads the current temporary file which was saved by \refEnv{tcbwritetemp}.
\tcblower
加载当前由\refEnv{tcbwritetemp}保存的临时文件。
\end{stripedbox}
\end{docCommand}


% \clearpage

\begin{docTcbKey}[][doc new=2017-07-05]{verbatim ignore percent}{\colOpt{=true\textbar false}}{default |true|, initially |false|}
\begin{stripedbox}
If this option is set to be |true|, the percent sign \% is silently
ignored for \refEnv{tcbverbatimwrite} and all macros and environments
which are built using \refEnv{tcbverbatimwrite}, e.g.\ 
\refEnv{tcbwritetemp}, \refEnv{tcblisting}, or \refEnv{dispExample}.\par
This option may be useful for creating some special effects, but mainly
it is intended to be applied for documentation with DocStrip.
The creation of this option was motivated by Yudai Nakata.
Note that this option is not getting reset by \refKey{/tcb/reset}.
\tcblower
如果该选项设置为|true|，%
对于\refEnv{tcbverbatimwrite}和所有基于\refEnv{tcbverbatimwrite}的宏和环境，百分比符号\%将被默默地忽略。例如 \refEnv{tcbwritetemp}, \refEnv{tcblisting}, 或 \refEnv{dispExample}.\par
这个选项可能对创建一些特殊效果有用，%
但它主要用于使用DocStrip进行文档编制。%
这个创意是由中田裕代(Yudai Nakata)提出的。%
注意，这个选项不会被\refKey{/tcb/reset}重置。
\end{stripedbox}

\begin{dispExample*}{sidebyside}
通常使用:
\begin{tcbwritetemp}
%\begin{center}\bfseries
这是我的文本.
%\end{center}
\end{tcbwritetemp}

\tcbusetemp

\tcbset{verbatim ignore percent}
\bigskip 应用选项:
\begin{tcbwritetemp}
%\begin{center}\bfseries
这是我的文本.
%\end{center}
\end{tcbwritetemp}

\tcbusetemp
\end{dispExample*}

\begin{marker}
\begin{stripedbox}
Note that \emph{every} percent sign is removed, also escaped ones.
\tcblower
注意，\emph{所有的}百分号被删除，包括转义的百分号。
\end{stripedbox}
\end{marker}

\begin{dispExample*}{sidebyside}
% \tcbuselibrary{listings}
\def\percent{\%}

\begin{tcblisting}{title=Normal}
%\begin{center}\bfseries
This is my 5\percent\ text
and this is my 10\% text.
%\end{center}
\end{tcblisting}

\begin{tcblisting}{
  title=Option applied,
  verbatim ignore percent}
%\begin{center}\bfseries
This is my 5\percent\ text
and this is my 10\% text.
%\end{center}
\end{tcblisting}
\end{dispExample*}

\end{docTcbKey}

