A |tcolorbox| may contain another |tcolorbox| and so on. The package
takes track of the nesting level using a counter |tcblayer|. Counter values
may be used for doing some fancy things, but you should never change
the counter value yourself.

一个|tcolorbox| 可以包含另一个 |tcolorbox|，以此类推。该包会使用计数器 |tcblayer| 来跟踪嵌套级别。计数器值可用于执行一些花哨的操作，但您不应自行更改计数器值。

% 一个 |tcolorbox| 盒子可能包含着另一个 |tcolorbox| 盒子，像俄罗斯套娃。本包使用计数器 |tcblayer| 记录盒子是处于嵌套的第几层。 可以用这个计数器值来做一些花哨的事情, 但你永远不应该改变这个计数器的值。

The package takes special care for the first four layers or nesting levels,
called managed layers.
Here, footnote texts are administrated to find their intended place
and specific layer dependent options may be set by changing
\refKey{/tcb/every box on layer n}.
If needed, the number of managed layers can be increased by setting
\refCom{tcbsetmanagedlayers} to a higher value than~4.

该包对前四个层级或嵌套层级（称为被管理的层级）进行特别关注。 在这里，脚注文本被管理以找到它们的预期位置， 并且可以通过更改\refKey{ /tcb/every box on layer n }来设置特定于层级的选项。 如果需要，可以通过将\refCom{tcbsetmanagedlayers}设置为大于4的值来增加被管理的层级数量。

% %todo 再次翻译
% 该包对前四层或嵌套层会特殊处理, 称为管理层。%
% 在这些层，脚注文本 are administrated to find their 预期位置 specific layer dependent options 可以通过 更改 \refKey{/tcb/every box on layer n} 来设置。
% 如果需要，可以通过将 \refCom{tcbsetmanagedlayers} 设置为高于~4 的值来增加管理层的数量。


The following styles have a considerable influence on how layered boxes
are processed. Note especially that nested boxes are getting a
\refKey{/tcb/reset} by default. You can change this, but be prepared for
surprises if you do.

以下样式对多层盒子的处理方式有相当大的影响。特别注意，嵌套的盒子默认会被设置 \refKey{/tcb/reset} 。您可以更改此设置，但如果你这样做，要做好惊讶的准备。

If the defaults are \emph{not changed}, a |tcolorbox| gets its options
in the following order. Following options overwrite preceding options.

如果默认值\emph{没有被改变}, 一个|tcolorbox|按以下顺序获取其选项。后出现的选项会覆盖前面的选项：


\begin{enumerate}
\item %On package load, all options are set to default values.
在包加载时，所有选项都设置为默认值。
\item %Every \refCom{tcbset} command adds or changes options for the following boxes inside the current \TeX\ group.
每个 \refCom{tcbset} 命令添加或更改当前 \TeX\ 组中后续盒子的选项。
\item 
%While entering a |tcolorbox|, a \refKey{/tcb/every box on layer n} or  \refKey{/tcb/every box on higher layers} option list is applied.  With default settings this means:

进入一个 |tcolorbox| 盒子, 会应用 \refKey{/tcb/every box on layer n} 或  \refKey{/tcb/every box on higher layers} 的选项列表。使用默认设置，这意味着：
\begin{itemize}
\item %
% For layer 1 (lowest layer), the \refKey{/tcb/every box} option list is applied.
%   Not overwritten options given by a preceding \refCom{tcbset} survive.
对于第 1 层（最低层）, 会应用 \refKey{/tcb/every box} 的选项列表。%
未被 \refCom{tcbset} 覆盖的选项仍然存在。
\item 
% For layer 2 and above (nested boxes), a \refKey{/tcb/reset} followed by \refKey{/tcb/every box} option list is applied.  Every resettable options given by a preceding \refCom{tcbset} and by the sourrounding box(es) are reset.
% todo 重新翻译
对于第 2 层及以上层（嵌套盒子），在 \refKey{/tcb/every box} 选项列表之后会应用 \refKey{/tcb/reset}。 所有能被重置的，由 \refCom{tcbset} 以及外层盒子给出的选项，会被重置。
\end{itemize}
\item 
% The \meta{options} given to the |tcolorbox| are applied.
%   Or, if the box was generated by \refCom{newtcolorbox} or friends,
%   the \meta{options} given there are applied.
直接在 |tcolorbox| 环境参数中设置的 \meta{选项} 被设置。或者,如果盒子生成是由 \refCom{newtcolorbox} 或类似命令, 那边给出的 \meta{选项} 被设置。
\item 
% If the box was generated by \refCom{newtcolorbox} or friends,  some automated options are applied.
如果盒子生成是由 \refCom{newtcolorbox} 或类似命令, 会自动被设置一些选项。
\end{enumerate}


\begin{docTcbKey}{every box}{}{style}
% By default, this style is empty.
默认情况下，此样式为空。
\begin{dispListing}
% default setting:
\tcbset{every box/.style={}}
\end{dispListing}
% It may be changed by redefining this style.
可以通过重新定义此样式来更改它。
\begin{dispListing}
% setting all boxes to be enhanced:
\tcbset{every box/.style={enhanced}}
\end{dispListing}

\medskip
\begin{marker}
% The alternative for setting something for every box (on every layer) is\\
为每个盒子（在每一层）设置一些东西的替代方法是\\
\refCom{tcbsetforeverylayer}:
\begin{dispListing}
% setting all boxes to be enhanced:
\tcbsetforeverylayer{enhanced}
\end{dispListing}
\end{marker}
\end{docTcbKey}




% \clearpage
\begin{docTcbKey}{every box on layer n}{}{style}
Here, |n| has to be replaced by a number ranging from 1 to the highest
managed layer number (4 by default).

在这里，|n|为从 1 到最高的托管层编号数字（默认为 4）。
\begin{dispListing}
% default settings:
\tcbset{
every box on layer 1/.style={every box},
every box on layer 2/.style={reset,every box},
every box on layer 3/.style={reset,every box},
every box on layer 4/.style={reset,every box},
}
\end{dispListing}
\end{docTcbKey}


\begin{docTcbKey}{every box on higher layers}{}{style}
Higher layers are layers above the highest
managed layer number (4 by default).

更高层是最高托管层数（默认为 4）之上的层。
\begin{dispListing}
\tcbset{every box on higher layers/.style={reset,every box}}
\end{dispListing}
\end{docTcbKey}




\begin{docCommand}{tcbsetmanagedlayers}{\marg{number}}
Replaces the highest managed layer number by \meta{number} where 4 is
the default. This macro can only be used inside the preamble.
Using a \meta{number} lower than 4 typically makes no sense, but is
not forbidden.

用 \meta{number} 替换最高管理层编号，其中 4 是默认值。该宏只能在序言内使用。使用小于 4 的 \meta{number} 通常没有意义，但是不禁止。
\end{docCommand}

\begin{tcboutputlisting}
% \usepackage{lipsum}
% \tcbuselibrary{skins,breakable}
\tcbset{colframe=red!75!black,fonttitle=\bfseries,
colback=red!5!white,
every box/.style={enhanced,watermark text=\thetcblayer,
    before=\par\smallskip,after=\par\smallskip},
every box on layer 2/.style={reset,every box,colback=yellow!10!white,
    drop fuzzy shadow}}
\begin{tcolorbox}[enhanced jigsaw,breakable,title=第1层盒子]
这里有一个脚注\footnote{第1层的脚注}。
\lipsum[2]
\begin{tcolorbox}[title=第2层盒子]
abc\footnote{第2层的脚注}
\end{tcolorbox}
\begin{tcolorbox}[title=Another Box,ams equation]
    \tcbhighmath{\sum\limits_{n=1}^{\infty} \frac{1}{n}} = \infty.
\end{tcolorbox}
Some text\footnote{Footnote from some text}.
\begin{tcolorbox}[title=Yet Another Box]%第2层
    第2层
    \tcboxfit[height=2cm]{\lipsum[1]}
    \begin{tcolorbox}
    第3层\footnote{第3层的脚注}. \lipsum[3]
    \begin{tcolorbox}[title=Layer 4,colframe=blue,colback=white]
        Layer 4\footnote{第4层}
    \end{tcolorbox}
    The End\footnote{第4层的脚注}.
    \end{tcolorbox}
\end{tcolorbox}
\end{tcolorbox}
\end{tcboutputlisting}

\tcbinputlisting{base example,listing only,listing style=mydocumentation}

{\tcbuselistingtext}